(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product-detail"],{"101f":function(t,e,s){"use strict";s.r(e);var i=s("34ab"),a=s("4b65");for(var c in a)"default"!==c&&function(t){s.d(e,t,function(){return a[t]})}(c);s("342e");var o=s("2877"),n=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},"342e":function(t,e,s){"use strict";var i=s("ffbc"),a=s.n(i);a.a},"34ab":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",[s("view",{staticClass:"status",style:{opacity:t.afterHeaderOpacity}}),s("view",{staticClass:"product-header"},[s("view",{staticClass:"before",style:{opacity:1-t.afterHeaderOpacity,zIndex:t.beforeHeaderzIndex}},[s("view",{staticClass:"back"},[t.showBack?s("view",{staticClass:"icon xiangqian",attrs:{eventid:"4ce8c978-0"},on:{tap:t.back}}):t._e()]),s("view",{staticClass:"middle"}),s("view",{staticClass:"icon-btn"},[s("view",{staticClass:"icon pin-icon",attrs:{eventid:"4ce8c978-1"},on:{tap:t.toMsg}},[t._v("notifications")]),s("view",{staticClass:"icon pin-icon",attrs:{eventid:"4ce8c978-2"},on:{tap:t.joinCart}},[t._v("shopping_cart")])])]),s("view",{staticClass:"after",style:{opacity:t.afterHeaderOpacity,zIndex:t.afterHeaderzIndex}},[s("view",{staticClass:"back"},[t.showBack?s("view",{staticClass:"icon pin-icon",attrs:{eventid:"4ce8c978-3"},on:{tap:t.back}},[t._v("arrow_back")]):t._e()]),s("view",{staticClass:"middle"},t._l(t.anchorlist,function(e,i){return s("view",{key:i,class:[t.selectAnchor==i?"on":""],attrs:{eventid:"4ce8c978-4-"+i},on:{tap:function(e){t.toAnchor(i)}}},[t._v(t._s(e.name))])})),s("view",{staticClass:"icon-btn"},[s("view",{staticClass:"icon pin-icon",attrs:{eventid:"4ce8c978-5"},on:{tap:t.toMsg}},[t._v("notifications")]),s("view",{staticClass:"icon pin-icon",attrs:{eventid:"4ce8c978-6"},on:{tap:t.joinCart}},[t._v("shopping_cart")])])])]),s("view",{staticClass:"footer"},[s("view",{staticClass:"icons"},[s("view",{staticClass:"box",attrs:{eventid:"4ce8c978-7"},on:{tap:t.share}},[s("view",{staticClass:"icon pin-icon"},[t._v("share")]),s("view",{staticClass:"text"},[t._v("分享")])]),s("view",{staticClass:"box",attrs:{eventid:"4ce8c978-8"},on:{tap:t.toChat}},[s("view",{staticClass:"icon pin-icon"},[t._v("contact_phone")]),s("view",{staticClass:"text"},[t._v("客服")])]),s("view",{staticClass:"box",attrs:{eventid:"4ce8c978-9"},on:{tap:t.keep}},[s("view",{staticClass:"icon pin-icon"},[t._v(t._s(t.isKeep?"star":"star_border"))]),s("view",{staticClass:"text"},[t._v(t._s(t.isKeep?"已":"")+"收藏")])])]),s("view",{staticClass:"btn"},[s("view",{staticClass:"joinCart",attrs:{eventid:"4ce8c978-10"},on:{tap:t.joinCart}},[t._v("加入购物车")]),s("view",{staticClass:"buy",attrs:{eventid:"4ce8c978-11"},on:{tap:t.buy}},[t._v("立即购买")])])]),s("view",{staticClass:"share",class:t.shareClass,attrs:{eventid:"4ce8c978-14"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.discard(e)},tap:t.hideShare}},[s("view",{staticClass:"mask"}),s("view",{staticClass:"layer",attrs:{eventid:"4ce8c978-13"},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[s("view",{staticClass:"h1"},[t._v("分享")]),t._m(0),s("view",{staticClass:"btn",attrs:{eventid:"4ce8c978-12"},on:{tap:t.hideShare}},[t._v("取消")])])]),s("view",{staticClass:"popup service",class:t.serviceClass,attrs:{eventid:"4ce8c978-17"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.discard(e)},tap:t.hideService}},[s("view",{staticClass:"mask"}),s("view",{staticClass:"layer",attrs:{eventid:"4ce8c978-16"},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[s("view",{staticClass:"content"},t._l(t.productData.service,function(e,i){return s("view",{key:i,staticClass:"row"},[s("view",{staticClass:"title"},[t._v(t._s(e.name))]),s("view",{staticClass:"description"},[t._v(t._s(e.description))])])})),s("view",{staticClass:"btn"},[s("view",{staticClass:"button",attrs:{eventid:"4ce8c978-15"},on:{tap:t.hideService}},[t._v("确定")])])])]),s("view",{staticClass:"popup spec",class:t.attributeModalClass,attrs:{eventid:"4ce8c978-25"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.discard(e)},tap:t.hideSpec}},[s("view",{staticClass:"mask"}),s("view",{staticClass:"layer",attrs:{eventid:"4ce8c978-24"},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[s("view",{staticClass:"content"},[t._l(t.productAttributes,function(e,i){return s("view",{key:e.attributeName+i},[s("view",{staticClass:"title"},[t._v(t._s(e.attributeName))]),s("view",{staticClass:"attrubite-chip-list"},t._l(e.attributeValues,function(a,c){return s("view",{key:a+c,staticClass:"attrubite-chip",class:[t.attributeSelectMap[e.attributeName]==a?"on":""],attrs:{eventid:"4ce8c978-18-"+i+"-"+c},on:{tap:function(s){t.setSelectAttribute(e.attributeName,a)}}},[t._v(t._s(a))])}))])}),null!=t.selectedResult.sku?s("view",{staticClass:"length"},[s("view",{staticClass:"text"},[t._v("数量 ("+t._s(t.productDetail.unitName)+")")]),s("view",{staticClass:"number"},[s("view",{staticClass:"sub",attrs:{eventid:"4ce8c978-19"},on:{tap:function(e){e.stopPropagation(),t.sub(e)}}},[s("view",{staticClass:"icon pin-icon"},[t._v("remove")])]),s("view",{staticClass:"input",attrs:{eventid:"4ce8c978-21"},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedResult.amount,expression:"selectedResult.amount"}],attrs:{type:"number",eventid:"4ce8c978-20"},domProps:{value:t.selectedResult.amount},on:{input:function(e){e.target.composing||(t.selectedResult.amount=e.target.value)}}})]),s("view",{staticClass:"add",attrs:{eventid:"4ce8c978-22"},on:{tap:function(e){e.stopPropagation(),t.add(e)}}},[s("view",{staticClass:"icon pin-icon"},[t._v("add")])])])]):t._e()],2),s("view",{directives:[{name:"show",rawName:"v-show",value:null!=t.productAttributeValuesMap[t.selectedResult.skuString]&&t.productAttributeValuesMap[t.selectedResult.skuString].stock>0,expression:"productAttributeValuesMap[selectedResult.skuString] != null && productAttributeValuesMap[selectedResult.skuString].stock >0"}],staticClass:"btn"},[s("view",{staticClass:"button",attrs:{eventid:"4ce8c978-23"},on:{tap:t.hideSpec}},[t._v("完成")])])])]),s("view",{staticClass:"swiper-box"},[s("swiper",{attrs:{circular:"true",autoplay:"true",eventid:"4ce8c978-27"},on:{change:t.swiperChange}},t._l(t.swiperList,function(e,i){return s("swiper-item",{key:e.id,attrs:{mpcomid:"4ce8c978-0-"+i}},[s("image",{attrs:{src:e.img,eventid:"4ce8c978-26-"+i},on:{tap:function(s){t.toSwiper(e)}}})])})),s("view",{staticClass:"indicator"},[t._v(t._s(t.currentSwiper+1)+"/"+t._s(t.swiperList.length))])],1),s("view",{staticClass:"info-box product-info"},[s("view",{staticClass:"price"},[t._v("￥"+t._s(t.productDetail.price))]),s("view",{staticClass:"title"},[t._v(t._s(t.productDetail.name))])]),s("view",{staticClass:"info-box spec"},[s("view",{staticClass:"row",attrs:{eventid:"4ce8c978-28"},on:{tap:t.showService}},[s("view",{staticClass:"text"},[t._v("服务")]),s("view",{staticClass:"content"},t._l(t.productData.service,function(e,i){return s("view",{key:i,staticClass:"serviceitem"},[t._v(t._s(e.name))])})),t._m(1)]),s("view",{staticClass:"row",attrs:{eventid:"4ce8c978-29"},on:{tap:function(e){t.showSpec(!1)}}},[s("view",{staticClass:"text"},[t._v("选择")]),s("view",{staticClass:"content"},[s("view",[t._v("选择规格："+t._s(null==t.selectedResult.sku?"未选择":t.selectedResult.skuString)+"\n\t\t\t\t\t"+t._s(0==t.selectedResult.amount?"":t.selectedResult.amount+t.productDetail.unitName))])]),t._m(2)])]),s("view",{staticClass:"info-box comments",attrs:{id:"comments"}},[s("view",{staticClass:"row"},[s("view",{staticClass:"text"},[t._v("商品评价")]),s("view",{staticClass:"arrow"},[s("view",{staticClass:"show",attrs:{eventid:"4ce8c978-30"},on:{tap:function(e){t.showComments(t.productDetail.id)}}},[t._v("查看全部"),s("view",{staticClass:"icon pin-icon"},[t._v("keyboard_arrow_right")])])])]),s("view",{staticClass:"comment"},[s("view",{staticClass:"user-info"},[s("view",{staticClass:"face"},[s("image",{attrs:{src:t.productData.comment.userface}})]),s("view",{staticClass:"username"},[t._v(t._s(t.productData.comment.username))])]),s("view",{staticClass:"content"},[t._v(t._s(t.productData.comment.content))])])]),s("view",{staticClass:"description"},[s("view",{staticClass:"title"},[t._v("———— 商品详情 ————")]),s("view",{staticClass:"content"},[s("rich-text",{attrs:{nodes:t.descriptionStr,mpcomid:"4ce8c978-1"}})],1)])])},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"list"},[s("view",{staticClass:"box"},[s("image",{attrs:{src:"../../static/img/share/wx.png"}}),s("view",{staticClass:"title"},[t._v("微信好友")])]),s("view",{staticClass:"box"},[s("image",{attrs:{src:"../../static/img/share/pyq.png"}}),s("view",{staticClass:"title"},[t._v("朋友圈")])]),s("view",{staticClass:"box"},[s("image",{attrs:{src:"../../static/img/share/wb.png"}}),s("view",{staticClass:"title"},[t._v("新浪微博")])]),s("view",{staticClass:"box"},[s("image",{attrs:{src:"../../static/img/share/qq.png"}}),s("view",{staticClass:"title"},[t._v("QQ")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"arrow"},[s("view",{staticClass:"icon pin-icon"},[t._v("keyboard_arrow_right")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"arrow"},[s("view",{staticClass:"icon pin-icon"},[t._v("keyboard_arrow_right")])])}];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return a})},"4b65":function(t,e,s){"use strict";s.r(e);var i=s("acb7"),a=s.n(i);for(var c in i)"default"!==c&&function(t){s.d(e,t,function(){return i[t]})}(c);e["default"]=a.a},8347:function(t,e,s){"use strict";s("6a7a");var i=c(s("b0ce")),a=c(s("101f"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},acb7:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={data:function(){return{beforeHeaderzIndex:11,afterHeaderzIndex:10,beforeHeaderOpacity:1,afterHeaderOpacity:0,swiperList:[],currentSwiper:0,anchorlist:[],selectAnchor:0,serviceClass:"",attributeModalClass:"",shareClass:"",productAttributes:[],productAttributeValuesMap:{},productSKUStockCache:{},productDetail:{},selectedResult:{sku:null,amount:1,skuString:""},attributeSelectMap:{},productData:{service:[{name:"正品保证",description:"此商品官方保证为正品"},{name:"极速退款",description:"此商品享受退货极速退款服务"},{name:"7天退换",description:"此商品享受7天无理由退换服务"}],comment:{number:102,userface:"../../static/img/face.jpg",username:"大黑哥",content:"很不错，之前买了很多次了，很好看，能放很久，和图片色差不大，值得购买！"}},selectSpec:null,isKeep:!1,descriptionStr:'<div style="text-align:center;"><img width="100%" src="https://s2.ax1x.com/2019/03/28/AdOogx.jpg"/><img width="100%" src="https://s2.ax1x.com/2019/03/28/AdOHKK.jpg"/><img width="100%" src="https://s2.ax1x.com/2019/03/28/AdOTv6.jpg"/></div>'}},onLoad:function(t){this.showBack=!1,console.log(t.productId),this.loadProductDetail(t.productId)},onReady:function(){this.calcAnchor()},onPageScroll:function(t){this.selectAnchor=t.scrollTop>=this.anchorlist[2].top?2:t.scrollTop>=this.anchorlist[1].top?1:0;var e=375;t.scrollTop=t.scrollTop>e?375:t.scrollTop,this.afterHeaderOpacity=t.scrollTop*(1/e),this.beforeHeaderOpacity=1-this.afterHeaderOpacity,this.beforeHeaderzIndex=t.scrollTop>0?10:11,this.afterHeaderzIndex=t.scrollTop>0?11:10},onReachBottom:function(){t.showToast({title:"触发上拉加载"})},methods:{loadProductDetail:function(e){var s=this;this.$pin.request("GET","/commons/product/"+e,null,function(e){console.log(e),s.productDetail=e.data,t.setNavigationBarTitle({title:s.productDetail.name}),s.swiperList.push({id:1,img:s.productDetail.imageUrls}),s.parseProductAttributes(e.data.productAttributeDefinitions,e.data.productAttributeValues)},function(e){console.log(e),t.showToast({icon:"none",title:"加载商品出错"})})},parseProductAttributes:function(t,e){for(var s=[],i=0;i<t.length;i++)s.push({attributeName:t[i].attributeName,attributeValues:t[i].attributeValues.split(";")}),this.attributeSelectMap[t[i].attributeName]=null;console.log(s),this.productAttributes=s;for(var a=0;a<e.length;a++)this.productAttributeValuesMap[e[a].sku]=e[a]},swiperChange:function(t){this.currentSwiper=t.detail.current},toMsg:function(){t.navigateTo({url:"../message/messages"})},toChat:function(){t.navigateTo({url:"../message/chat/chat?name=客服008"})},share:function(){this.shareClass="show"},hideShare:function(){var t=this;this.shareClass="hide",setTimeout(function(){t.shareClass="none"},150)},keep:function(){this.isKeep=!this.isKeep},joinCart:function(){if(null==this.selectedResult.sku||""==this.selectedResult.skuString)return t.showToast({icon:"none",title:"请选择规格"}),void this.showSpec(this.joinCart);null==this.selectedResult.amount||this.selectedResult.amount<=0?t.showToast({icon:"none",title:"请至少选择一件商品加入购物车"}):this.$pin.request("POST","/commons/order/order-item",{productId:this.productDetail.id,skuId:this.selectedResult.sku.id,amount:this.selectedResult.amount},function(e){t.showToast({title:"已加入购物车"})},function(e){t.showToast({icon:"none",title:"加入购物车失败，请重试"})})},buy:function(){var t=this;if(null==this.selectSpec)return this.showSpec(function(){t.toConfirmation()});this.toConfirmation()},toConfirmation:function(){var e=[],s={id:this.productData.id,img:"../../static/img/product/p1.jpg",name:this.productData.name,spec:"规格:"+this.productData.spec[this.selectSpec],price:this.productData.price,number:this.productData.number};e.push(s),t.setStorage({key:"buylist",data:e,success:function(){t.navigateTo({url:"../order/confirmation"})}})},showComments:function(t){},setSelectAttribute:function(t,e){console.log(t+"--"+e),this.attributeSelectMap[t]=e;for(var s="",i=0;i<this.productAttributes.length;i++){var a=this.attributeSelectMap[this.productAttributes[i].attributeName];null!=a&&(s+=a,i<this.productAttributes.length-1&&(s+=";"))}this.getSKUStockNum(s),this.selectedResult.skuString=s,this.selectedResult.sku=this.productAttributeValuesMap[s],this.$forceUpdate()},getSKUStockNum:function(t){var e,s,i,a,c=0,o=[];if("undefined"!=typeof this.productSKUStockCache[t])return this.productSKUStockCache[t];if(a=t.split(";"),a.length===this.productAttributes.length)return this.productAttributeValuesMap[t]?this.productAttributeValuesMap[t].stock:0;for(e=0;e<this.productAttributes.length;e++){for(s=0;s<this.productAttributes[e].attributeValues.length&&a.length>0;s++)if(this.productAttributes[e].attributeValues[s]==a[0])break;if(!(s<this.productAttributes[e].attributeValues.length&&a.length>0)){for(i=0;i<this.productAttributes[e].attributeValues.length;i++)c+=this.getSKUStockNum(o.concat(this.productAttributes[e].attributeValues[i],a).join(";"));break}o.push(a.shift())}return this.productSKUStockCache[t]=c,c},sub:function(){this.selectedResult.amount<=1||this.selectedResult.amount--},add:function(){var e=this.productAttributeValuesMap[this.selectedResult.skuString].stock;null==e||e<=this.selectedResult.amount?t.showToast({title:"已达到库存上限",icon:"none"}):this.selectedResult.amount++},toAnchor:function(e){this.selectAnchor=e,t.pageScrollTo({scrollTop:this.anchorlist[e].top,duration:200})},calcAnchor:function(){var e=this;this.anchorlist=[{name:"主图",top:0},{name:"评价",top:0},{name:"详情",top:0}];var s=t.createSelectorQuery().select("#comments");s.boundingClientRect(function(s){var i=0,a=t.upx2px(100);e.anchorlist[1].top=s.top-a-i,e.anchorlist[2].top=s.bottom-a-i}).exec()},back:function(){t.navigateBack()},showService:function(){console.log("show"),this.serviceClass="show"},hideService:function(){var t=this;this.serviceClass="hide",setTimeout(function(){t.serviceClass="none"},200)},showSpec:function(t){console.log("show"),this.attributeModalClass="show",this.specCallback=t},specCallback:function(){},hideSpec:function(){var t=this;this.attributeModalClass="hide",this.selectSpec&&this.specCallback&&this.specCallback(),this.specCallback=!1,setTimeout(function(){t.attributeModalClass="none"},200)},discard:function(){}}};e.default=s}).call(this,s("543d")["default"])},ffbc:function(t,e,s){}},[["8347","common/runtime","common/vendor"]]]);