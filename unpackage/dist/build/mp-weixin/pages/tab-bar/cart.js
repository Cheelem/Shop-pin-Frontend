(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tab-bar/cart"],{"0ac7":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",[null==t.orderItemList||0==t.orderItemList.length?s("view",[s("full-page-empty-state",{attrs:{title:"购物车为空",description:"到处逛逛并把他们加入购物车吧",icon:"shopping_cart",mpcomid:"48ee9906-0"}})],1):s("view",{staticClass:"goods-list"},t._l(t.orderItemMapByStore,function(e,i){return s("view",{key:e,staticClass:"pin-card"},[s("view",{staticClass:"pin-card-title"},[s("view",{staticClass:"checkbox-box",attrs:{eventid:"48ee9906-0-"+i},on:{tap:function(s){t.allSelectByStore(e.storeId)}}},[s("view",{staticClass:"checkbox"},[s("view",{class:[t.selectedStoreIdMap[e.storeId]?"on":""]})]),s("view",{staticClass:"text"},[s("i",{staticClass:"pin-icon"},[t._v("store")]),t._v(t._s(e.storeName))],1)])]),t._l(e.items,function(e,o){return s("view",{key:e,staticClass:"row"},[s("view",{staticClass:"menu",attrs:{eventid:"48ee9906-1-"+i+"-"+o},on:{tap:function(s){s.stopPropagation(),t.deleteGoods(e.id)}}},[s("view",{staticClass:"icon pin-icon"},[t._v("delete")])]),s("view",{staticClass:"carrier",class:[t.theIndex==o?"open":t.oldIndex==o?"close":""],attrs:{eventid:"48ee9906-8-"+i+"-"+o},on:{touchstart:function(e){t.touchStart(o,e)},touchmove:function(e){t.touchMove(o,e)},touchend:function(e){t.touchEnd(o,e)}}},[s("view",{staticClass:"checkbox-box",attrs:{eventid:"48ee9906-2-"+i+"-"+o},on:{tap:function(s){t.selected(e)}}},[s("view",{staticClass:"checkbox"},[s("view",{class:[1==t.selectedOrderItemIdMap[e.id]?"on":""]})])]),s("view",{staticClass:"goods-info",attrs:{eventid:"48ee9906-7-"+i+"-"+o},on:{tap:function(s){t.toProduct(e.product.id)}}},[s("view",{staticClass:"img"},[s("image",{attrs:{mode:"aspectFill",src:e.product.imageUrls}})]),s("view",{staticClass:"info"},[s("view",{staticClass:"title"},[t._v(t._s(e.product.name))]),s("view",{staticClass:"spec"},[t._v(t._s(e.productAttributeValue.sku))]),s("view",{staticClass:"price-number"},[s("view",{staticClass:"price"},[s("text",{staticClass:"pin-primary pin-text-lg"},[t._v("￥"+t._s(e.totalPrice))]),s("text",{staticClass:"pin-accent pin-text-xs"},[t._v("(单价 ￥"+t._s(e.product.price)+")")])]),s("view",{staticClass:"number"},[s("view",{staticClass:"sub",attrs:{eventid:"48ee9906-3-"+i+"-"+o},on:{tap:function(e){e.stopPropagation(),t.sub(o)}}},[s("view",{staticClass:"icon pin-icon"},[t._v("remove")])]),s("view",{staticClass:"input",attrs:{eventid:"48ee9906-5-"+i+"-"+o},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.amount,expression:"orderItem.amount"}],attrs:{type:"number",eventid:"48ee9906-4-"+i+"-"+o},domProps:{value:e.amount},on:{input:[function(t){t.target.composing||(e.amount=t.target.value)},function(e){t.sum(e,o)}]}})]),s("view",{staticClass:"add",attrs:{eventid:"48ee9906-6-"+i+"-"+o},on:{tap:function(e){e.stopPropagation(),t.add(o)}}},[s("view",{staticClass:"icon pin-icon"},[t._v("add")])])])])])])])])})],2)})),s("view",{staticClass:"footer",style:{bottom:t.footerbottom}},[s("view",{staticClass:"checkbox-box",attrs:{eventid:"48ee9906-9"},on:{tap:t.allSelect}},[s("view",{staticClass:"checkbox"},[s("view",{class:[t.isAllselected?"on":""]})]),s("view",{staticClass:"text"},[t._v("全选")])]),t.selectedOrderItemIdList.length>0?s("view",{staticClass:"delete-button",attrs:{eventid:"48ee9906-10"},on:{tap:t.deleteSelectedList}},[t._v("删除已选")]):t._e(),s("view",{staticClass:"settlement"},[s("view",{staticClass:"sum"},[t._v("合计:"),s("view",{staticClass:"money"},[t._v("￥"+t._s(t.sumPrice))])]),s("view",{staticClass:"pin-button",attrs:{eventid:"48ee9906-11"},on:{tap:t.toConfirmation}},[t._v("结算("+t._s(t.selectedOrderItemIdList.length)+")")])])])])},o=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return o})},"2df4":function(t,e,s){"use strict";s("6a7a");var i=r(s("b0ce")),o=r(s("77ba"));function r(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(o.default))},4780:function(t,e,s){},"77ba":function(t,e,s){"use strict";s.r(e);var i=s("0ac7"),o=s("8243");for(var r in o)"default"!==r&&function(t){s.d(e,t,function(){return o[t]})}(r);s("d6ed");var d=s("2877"),n=Object(d["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},8243:function(t,e,s){"use strict";s.r(e);var i=s("aff6"),o=s.n(i);for(var r in i)"default"!==r&&function(t){s.d(e,t,function(){return i[t]})}(r);e["default"]=o.a},aff6:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(s("f0b6"));function r(t){return t&&t.__esModule?t:{default:t}}var d={components:{"full-page-empty-state":o.default},data:function(){return{sumPrice:"0.00",headerPosition:"fixed",headerTop:0,statusTop:null,selectedOrderItemIdList:[],selectedOrderItemIdMap:{},selectedStoreIdMap:{},isAllselected:!1,orderItemMapByStore:{},orderItemList:[],theIndex:null,oldIndex:null,isStop:!1}},onPageScroll:function(t){this.headerPosition=t.scrollTop>=0?"fixed":"absolute",this.headerTop=t.scrollTop>=0?null:0,this.statusTop=t.scrollTop>=0?null:-this.statusHeight+"px"},onPullDownRefresh:function(){this.loadMyCartItems()},onLoad:function(){},onShow:function(){this.loadMyCartItems()},methods:{joinGoods:function(t){for(var e=this.orderItemList.length,s=!1,o=0;o<e;o++){var r=this.orderItemList[o];if(r.id==t.id){this.orderItemList[o].number++,s=!0;break}}s||this.orderItemList[i].unshift(t)},touchStart:function(t,e){e.touches.length>1?this.isStop=!0:(this.oldIndex=this.theIndex,this.theIndex=null,this.initXY=[e.touches[0].pageX,e.touches[0].pageY])},touchMove:function(t,e){var s=this;if(e.touches.length>1)this.isStop=!0;else{var i=e.touches[0].pageX-this.initXY[0],o=e.touches[0].pageY-this.initXY[1];this.isStop||Math.abs(i)<5||(Math.abs(o)>Math.abs(i)?this.isStop=!0:i<0?(this.theIndex=t,this.isStop=!0):i>0&&null!=this.theIndex&&this.oldIndex==this.theIndex&&(this.oldIndex=t,this.theIndex=null,this.isStop=!0,setTimeout(function(){s.oldIndex=null},150)))}},touchEnd:function(t,e){this.isStop=!1},toProduct:function(e){t.navigateTo({url:"../product/product-detail?productId="+e})},toConfirmation:function(){if(this.selectedOrderItemIdList.length<1)t.showToast({title:"请选择商品以结算",icon:"none"});else{var e=[];console.log("confirm");for(var s=0;s<this.orderItemList.length;s++){var i=this.orderItemList[s];console.log(i),console.log(this.selectedOrderItemIdMap[i.id]),1==this.selectedOrderItemIdMap[i.id]&&e.push(i)}t.setStorage({key:"cart-list-to-confirm",data:e,success:function(){t.navigateTo({url:"../order/confirmation"})}})}},deleteGoods:function(t){var e=[];e.push(t),-1!=this.selectedOrderItemIdList.indexOf(t)&&(this.selectedOrderItemIdList.splice(index,1),this.selectedOrderItemIdMap[orderItemSelected.id]=!1),this.sum(),this.deleteMyCartItems(e)},deleteSelectedList:function(){var t=this.selectedOrderItemIdList;this.selectedOrderItemIdList=[],this.selectedOrderItemIdMap={},this.sum(),this.deleteMyCartItems(t)},selected:function(t,e){var s=this.selectedOrderItemIdList.indexOf(t.id);console.log(s),-1==s?(this.selectedOrderItemIdList.push(t.id),this.selectedOrderItemIdMap[t.id]=!0):(this.selectedOrderItemIdList.splice(s,1),this.selectedOrderItemIdMap[t.id]=!1),null!=e&&0!=e||this.sum()},allSelectByStore:function(t){var e=this.orderItemMapByStore[t].items;console.log(e),null==this.selectedStoreIdMap[t]||0==this.selectedStoreIdMap[t]?this.selectedStoreIdMap[t]=!0:this.selectedStoreIdMap[t]=!1;for(var s=0;s<e.length;s++){var i=e[s],o=this.selectedOrderItemIdList.indexOf(i.id);console.log(o),-1==o&&this.selectedStoreIdMap[t]?(this.selectedOrderItemIdList.push(i.id),this.selectedOrderItemIdMap[i.id]=!0):this.selectedStoreIdMap[t]||(this.selectedOrderItemIdList.splice(o,1),this.selectedOrderItemIdMap[i.id]=!1)}this.sum()},allSelect:function(){var t=this.orderItemList.length;this.isAllselected=!this.isAllselected&&0!=this.orderItemList.length;for(var e=0;e<t;e++){var s=this.orderItemList[e],i=this.selectedOrderItemIdList.indexOf(s.id);console.log(i),-1==i&&this.isAllselected?(this.selectedOrderItemIdList.push(s.id),this.selectedOrderItemIdMap[s.id]=!0,this.selectedStoreIdMap[s.storeId]=!0):this.isAllselected||(this.selectedOrderItemIdList.splice(i,1),this.selectedOrderItemIdMap[s.id]=!1,this.selectedStoreIdMap[s.storeId]=!1)}this.sum()},sub:function(t){this.orderItemList[t].number<=1||(this.orderItemList[t].number--,this.sum())},add:function(t){this.orderItemList[t].number++,this.sum()},sum:function(t,e){this.sumPrice=0;for(var s=this.orderItemList.length,i=0;i<s;i++){var o=this.orderItemList[i];this.selectedOrderItemIdMap[o.id]&&(this.sumPrice=t&&i==e?this.sumPrice+t.detail.value*o.product.price:this.sumPrice+o.amount*o.product.price)}this.sumPrice=this.sumPrice.toFixed(2)},discard:function(){},deleteMyCartItems:function(t){var e=this;this.$pin.request("DELETE","/commons/order/order-items",{orderItems:t},function(t){e.loadMyCartItems()},function(t){})},loadMyCartItems:function(){var e=this;this.$pin.request("GET","/commons/order/order-items",null,function(s){s.code==e.$pin.code.success?(e.orderItemList=s.data.orderItems,e.parseOrderItemsByStore(s.data.orderItems)):t.showToast({title:"加载购物车内容失败。"})},function(e){t.showToast({title:"加载购物车内容失败，请重试。"})},function(){t.stopPullDownRefresh()})},parseOrderItemsByStore:function(t){var e={};for(var s in t){var i=t[s];console.log(i);var o=i.product.store.id,r=i.product.store.name;null==e[o]&&(e[o]={},e[o].storeId=o,e[o].storeName=r,e[o].items=[]),e[o].items.push(i)}this.orderItemMapByStore=e}}};e.default=d}).call(this,s("543d")["default"])},d6ed:function(t,e,s){"use strict";var i=s("4780"),o=s.n(i);o.a}},[["2df4","common/runtime","common/vendor"]]]);